!function($){$.fn.gridEditor=function(A){var e=this,t=e.data("grideditor");if("getHtml"==A){if(t){t.deinit();var n=e.html();return t.init(),n}return e.html()}if("remove"!=A)return e.each(function(e,a){a=$(a);var i,s,c,l,r,d=$.extend({new_row_layouts:[[12],[6,6],[4,4,4],[3,3,3,3],[2,2,2,2,2,2],[2,8,2],[4,8],[8,4]],row_classes:[{label:"Example class",cssClass:"example-class"}],col_classes:[{label:"Example class",cssClass:"example-class"}],col_tools:[],row_tools:[],custom_filter:"",content_types:["tinymce"],valid_col_sizes:[1,2,3,4,5,6,7,8,9,10,11,12],source_textarea:""},A),u=["col-md-","col-sm-","col-xs-"],p=0,h=12;if(d.source_textarea&&a.html($(d.source_textarea).val()),a.children().length&&!a.find("div.row").length){var t=a.children();$('<div class="row"><div class="col-md-12"/></div>').appendTo(a).find(".col-md-12").append(t)}function f(e){var t=$(window);t.scrollTop()>s.offset().top&&t.scrollTop()<i.offset().top+i.height()?c.hasClass("ge-top")&&c.css({left:c.offset().left,width:c.outerWidth()}).removeClass("ge-top").addClass("ge-fixed"):c.hasClass("ge-fixed")&&c.css({left:"",width:""}).removeClass("ge-fixed").addClass("ge-top")}function g(e){if(!$(this).hasClass("ge-rte-active")){var t=M($(this).data("ge-content-type"));t&&($(this).addClass("ge-rte-active",!0),t.init(d,$(this)))}}function v(){n(!0),i.addClass("ge-editing"),i.find('.column, div[class*="col-"]').each(function(){var t=$(this),n=2,e=b(t);e.length&&(n=e[0].size);var o=t.attr("class");u.forEach(function(e){-1==o.indexOf(e)&&t.addClass(e+n)}),t.addClass("column")}),i.find(".column").each(function(){var e=$(this),t=$();e.children().each(function(){var e=$(this);e.is(".row, .ge-tools-drawer, .ge-content")?o(t):t=t.add(e)}),o(t)}),i.find(".row").each(function(){var e=$(this);if(!e.find("> .ge-tools-drawer").length){var t=$('<div class="ge-tools-drawer" />').prependTo(e);y(t,"Move","ge-move","glyphicon-move"),y(t,"Settings","","glyphicon-cog",function(){i.toggle()}),d.row_tools.forEach(function(e){y(t,e.title||"",e.className||"",e.iconClass||"glyphicon-wrench",e.on)}),y(t,"Remove row","","glyphicon-trash",function(){window.confirm("Delete row?")&&e.slideUp(function(){e.remove()})});var n=e.parent("#"+a.attr("id")).length||e.parent(".container").parent("#"+a.attr("id")).length,o=e.parent(".container").parent("#"+a.attr("id")).length;n&&y(t,"Container","add-container"+(o?" ge-container-active":""),"glyphicon-inbox",{click:function(){$(this).closest(".row.ui-sortable").parent(".container").length?(e.unwrap(),$(this).removeClass("ge-container-active")):(e.wrap('<div class="container"></div>'),$(this).addClass("ge-container-active"))}}),y(t,"Add column","ge-add-column","glyphicon-plus-sign",function(){e.append(k(3)),v()});var i=w(e,d.row_classes).appendTo(t)}}),i.find(".column").each(function(){var s=$(this);if(!s.find("> .ge-tools-drawer").length){var t=$('<div class="ge-tools-drawer" />').prependTo(s);y(t,"Move","ge-move","glyphicon-move"),y(t,"Make column narrower\n(hold shift for min)","ge-decrease-col-width","glyphicon-minus",function(e){var t=d.valid_col_sizes,n=u[p],o=t.indexOf(C(s,n)),i=t[R(o-1,0,t.length-1)];e.shiftKey&&(i=t[0]),x(s,n,Math.max(i,1))}),y(t,"Make column wider\n(hold shift for max)","ge-increase-col-width","glyphicon-plus",function(e){var t=d.valid_col_sizes,n=u[p],o=t.indexOf(C(s,n)),i=R(o+1,0,t.length-1),a=t[i];e.shiftKey&&(a=t[t.length-1]),x(s,n,Math.min(a,h))}),y(t,"Settings","","glyphicon-cog",function(){e.toggle()}),d.col_tools.forEach(function(e){y(t,e.title||"",e.className||"",e.iconClass||"glyphicon-wrench",e.on)}),y(t,"Remove col","","glyphicon-trash",function(){window.confirm("Delete column?")&&s.animate({opacity:"hide",width:"hide",height:"hide"},400,function(){s.remove()})}),y(t,"Add row","ge-add-row","glyphicon-plus-sign",function(){var e=T();s.append(e),e.append(k(6)).append(k(6)),v()});var e=w(s,d.col_classes).appendTo(t)}}),function(){function e(e,t){t.placeholder.css({height:t.item.outerHeight()})}i.find(".row").sortable({items:"> .column",connectWith:".ge-canvas .row",handle:"> .ge-tools-drawer .ge-move",start:e,helper:"clone"}),i.add(i.find(".column")).sortable({items:"> .row, > .ge-content",connectsWith:".ge-canvas, .ge-canvas .column",handle:"> .ge-tools-drawer .ge-move",start:e,helper:"clone"})}(),_(p)}function m(){i.removeClass("ge-editing");i.find(".ge-content").removeClass("ge-rte-active").each(function(){var e=$(this);M(e.data("ge-content-type")).deinit(d,e)});i.find(".ge-tools-drawer").remove(),i.add(i.find(".column")).add(i.find(".row")).sortable("destroy"),n(!1)}function y(e,t,n,o,i){var a=$('<a title="'+t+'" class="'+n+'"><span class="glyphicon '+o+'"></span></a>').appendTo(e);"function"==typeof i&&a.on("click",i),"object"==typeof i&&$.each(i,function(e,t){a.on(e,t)})}function w(n,e){var t=$('<div class="ge-details" />');$('<input class="ge-id" />').attr("placeholder","id").val(n.attr("id")).attr("title","Set a unique identifier").appendTo(t).change(function(){n.attr("id",this.value)});var o=$('<div class="btn-group" />').appendTo(t);return e.forEach(function(e){var t=$('<a class="btn btn-xs btn-default" />').html(e.label).attr("title",e.title?e.title:'Toggle "'+e.label+'" styling').toggleClass("active btn-primary",n.hasClass(e.cssClass)).on("click",function(){t.toggleClass("active btn-primary"),n.toggleClass(e.cssClass,t.hasClass("active"))}).appendTo(o)}),t}function C(e,t){for(var n=b(e),o=0;o<n.length;o++)if(n[o].colClass==t)return n[o].size;return n.length?n[0].size:null}function b(n){var o=[];return u.forEach(function(e){var t=new RegExp(e+"(\\d+)","i");t.test(n.attr("class"))&&o.push({colClass:e,size:parseInt(t.exec(n.attr("class"))[1])})}),o}function x(e,t,n){var o=new RegExp("("+t+"(\\d+))","i").exec(e.attr("class"));o&&parseInt(o[2])!==n?e.switchClass(o[1],t+n,50):e.addClass(t+n)}function T(){return $('<div class="row" />')}function k(t){return $("<div/>").addClass(u.map(function(e){return e+t}).join(" ")).append(E().html(M(d.content_types[0]).initialContent))}function n(n){d.custom_filter.length&&$.each(d.custom_filter,function(e,t){"string"==typeof t&&(t=window[t]),t(i,n)})}function o(e){if(e.length){var t=E().insertAfter(e.last());e.appendTo(t),e=$()}}function E(){return $("<div/>").addClass("ge-content ge-content-type-"+d.content_types[0]).attr("data-ge-content-type",d.content_types[0])}function _(n){p=n;["ge-layout-desktop","ge-layout-tablet","ge-layout-phone"].forEach(function(e,t){i.toggleClass(e,t==n)})}function M(e){return $.fn.gridEditor.RTEs[e]}function R(e,t,n){return Math.min(n,Math.max(t,e))}!function(){i=a.addClass("ge-canvas"),r=$('<textarea class="ge-html-output"/>').insertBefore(i),s=$('<div class="ge-mainControls" />').insertBefore(r),c=$('<div class="ge-wrapper ge-top" />').appendTo(s),l=$('<div class="ge-addRowGroup btn-group" />').appendTo(c),$.each(d.new_row_layouts,function(e,n){var t=$('<a class="btn btn-xs btn-primary" />').attr("title","Add row "+n.join("-")).on("click",function(){var t=T().appendTo(i);n.forEach(function(e){k(e).appendTo(t)}),v()}).appendTo(l);t.append('<span class="glyphicon glyphicon-plus-sign"/>');n.join(" - ");var o='<div class="row ge-row-icon">';n.forEach(function(e){o+='<div class="column col-xs-'+e+'"/>'}),o+="</div>",t.append(o)});var n=$('<div class="dropdown pull-right ge-layout-mode"><button type="button" class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown"><span>Desktop</span></button><ul class="dropdown-menu" role="menu"><li><a data-width="auto" title="Desktop"><span>Desktop</span></a></li><li><a title="Tablet"><span>Tablet</span></li><li><a title="Phone"><span>Phone</span></a></li></ul></div>').on("click","a",function(){var e=$(this);_(e.closest("li").index());var t=n.find("button");t.find("span").remove(),t.append(e.find("span").clone())}).appendTo(c),e=$('<div class="btn-group pull-right"/>').appendTo(c),t=$('<button title="Edit Source Code" type="button" class="btn btn-xs btn-primary gm-edit-mode"><span class="glyphicon glyphicon-chevron-left"></span><span class="glyphicon glyphicon-chevron-right"></span></button>').on("click",function(){t.hasClass("active")?(i.empty().html(r.val()).show(),v(),r.hide()):(m(),r.height(.8*$(window).height()).val(i.html()).show(),i.hide()),t.toggleClass("active btn-danger")}).appendTo(e),o=$('<button title="Preview" type="button" class="btn btn-xs btn-primary gm-preview"><span class="glyphicon glyphicon-eye-open"></span></button>').on("mouseenter",function(){i.removeClass("ge-editing")}).on("click",function(){o.toggleClass("active btn-danger").trigger("mouseleave")}).on("mouseleave",function(){o.hasClass("active")||i.addClass("ge-editing")}).appendTo(e);$(window).on("scroll",f),i.on("click",".ge-content",g)}(),v(),a.data("grideditor",{init:v,deinit:m,remove:function(){m(),s.remove(),r.remove(),$(window).off("scroll",f),i.off("click",".ge-content",g),i.removeData("grideditor")}})}),e;t&&t.remove()},$.fn.gridEditor.RTEs={}}(jQuery),$.fn.gridEditor.RTEs.ckeditor={init:function(o,e){window.CKEDITOR||console.error("CKEditor not available! Make sure you loaded the ckeditor and jquery adapter js files.");var i=this;e.each(function(){var e=$(this);if(!e.hasClass("active")){e.html()==i.initialContent&&e.html("&nbsp;"),e.addClass("active").attr("contenteditable","true");var t=$.extend({},o.ckeditor&&o.ckeditor.config?o.ckeditor.config:{},{on:{instanceReady:function(e){var t;try{t=o.ckeditor.config.on.instanceReady}catch(e){}t&&t.call(this,e),n.focus()}}}),n=CKEDITOR.inline(e.get(0),t)}})},deinit:function(e,t){t.filter(".active").each(function(){var e=$(this);$.each(CKEDITOR.instances,function(e,t){t.destroy()}),e.removeClass("active cke_focus").removeAttr("id").removeAttr("style").removeAttr("spellcheck").removeAttr("contenteditable")})},initialContent:"<p>Lorem initius... </p>"},$.fn.gridEditor.RTEs.summernote={init:function(n,e){jQuery().summernote||console.error("Summernote not available! Make sure you loaded the Summernote js file.");var o=this;e.each(function(){var t=$(this);if(!t.hasClass("active")){t.html()==o.initialContent&&t.html(""),t.addClass("active");var e=$.extend(!0,{},n.summernote&&n.summernote.config?n.summernote.config:{},{tabsize:2,airMode:!0,callbacks:{onInit:function(){var e;try{e=n.summernote.config.callbacks.onInit}catch(e){}e&&e.call(this),t.summernote("focus")}}});t.summernote(e)}})},deinit:function(e,t){t.filter(".active").each(function(){var e=$(this);e.summernote("destroy"),e.removeClass("active").removeAttr("id").removeAttr("style").removeAttr("spellcheck")})},initialContent:"<p>Lorem ipsum dolores</p>"},$.fn.gridEditor.RTEs.tinymce={init:function(n,e){window.tinymce||console.error("tinyMCE not available! Make sure you loaded the tinyMCE js file."),e.tinymce||console.error("tinyMCE jquery integration not available! Make sure you loaded the jquery integration plugin.");var o=this;e.each(function(){var e=$(this);if(!e.hasClass("active")){e.html()==o.initialContent&&e.html(""),e.addClass("active");var t=$.extend({},n.tinymce&&n.tinymce.config?n.tinymce.config:{},{inline:!0,oninit:function(e){var t;$("#"+e.settings.id).focus();try{t=n.tinymce.config.oninit}catch(e){}t&&t.call(this)}});e.tinymce(t)}})},deinit:function(e,t){t.filter(".active").each(function(){var e=$(this),t=e.tinymce();t&&t.remove(),e.removeClass("active").removeAttr("id").removeAttr("style").removeAttr("spellcheck")})},initialContent:"<p>Lorem ipsum dolores</p>"};